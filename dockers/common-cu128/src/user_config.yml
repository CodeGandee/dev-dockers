# Canonical PeiDocker config for this environment.
# Applied by ../pei-configure.sh (copied to src/user_config.yml before configure).

stage_1:
  image:
    base: docker.1ms.run/nvidia/cuda:12.8.1-cudnn-devel-ubuntu24.04
    output: ig-common:cu128-stage-1

  ssh:
    enable: true
    port: 22
    host_port: ${HOST_PORT_SSH:-2222}
    users:
      peid:
        password: '123456'
        uid: 3100
        gid: 1100
        pubkey_file: ''

  proxy:
    address: host.docker.internal
    port: ${HOST_PORT_PROXY:-7890}
    enable_globally: false
    remove_after_build: true
    use_https: false

  apt:
    repo_source: 'tuna'
    keep_repo_after_build: true
    use_proxy: false
    keep_proxy_after_build: false

  environment:
    - 'CUDA_HOME=/usr/local/cuda'

  ports: []

  device:
    type: gpu

  mount: {}

  custom:
    on_build:
      - 'stage-1/custom/install-apt-packages.sh'
      - 'stage-1/custom/install-uv.sh'
    on_first_run: []
    on_every_run: []
    on_user_login: []
    on_entry: []

stage_2:
  image:
    base: null
    output: ig-common:cu128

  environment:
    - 'CUDA_HOME=/usr/local/cuda'

  ports: []

  device:
    type: gpu

  proxy:
    address: null
    port: null
    enable_globally: null
    remove_after_build: null
    use_https: null

  storage:
    app:
      type: auto-volume
      host_path: null
      volume_name: null
    data:
      type: auto-volume
      host_path: null
      volume_name: null
    workspace:
      type: auto-volume
      host_path: null
      volume_name: null

  mount:
    home_peid:
      type: auto-volume
      dst_path: /home/peid
      host_path: null
      volume_name: null

  custom:
    on_build:
      - 'stage-2/custom/install-devtools.sh'
    on_first_run: []
    on_every_run: []
    on_user_login: []
    on_entry: []
